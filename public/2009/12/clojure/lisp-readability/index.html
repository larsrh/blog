<!DOCTYPE html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="author" content="Stefan Tilkov">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="canonical" href="https://www.innoq.comhttps://www.innoq.com/blog/st/2009/12/clojure/lisp-readability/">
  <link href="/blog/st/favicon.png" rel="icon">
  <link href="/blog/st/atom.xml" rel="alternate" title="Stefan Tilkov's Blog" type="application/atom+xml">


  <link rel="stylesheet" href="https://bootstrap.assets.innoq.com/css/0.0.9/innoq-bootstrap-theme.css" />
  <link rel="stylesheet" href="/blog/st/stylesheets/blog.css" />

  <title>Clojure/Lisp Readability [Stefan Tilkov’s Blog]</title>
  
</head>


  <body>

    <nav class="navbar navbar-expand-lg navbar-light">
  <a class="navbar-brand m-2 p-2" href="https://www.innoq.com/"><img alt="INNOQ logo" height="40" src="https://innoq.style/assets/innoq-logo--whitered.svg" /></a>
  <a class="navbar-brand text-light" href="/blog/st/">Stefan Tilkov’s Blog Archive</a>
</nav>





    <main class="container">
      <p class="mt-5"><em>
	This is a single archived entry from Stefan Tilkov’s blog. For more up-to-date content,
	check out my <a href="https://www.innoq.com/en/staff/stefan-tilkov/">author page at INNOQ</a>,
	which has more information about me and also contains a list of published talks, podcasts, and articles.
	Or you can check out the <a href="/blog/st/">full archive</a>.

      </em></p>
      <article>
	<header>
          <h1>Clojure/Lisp Readability</h1>
	  <p><small><a href="https://www.innoq.com/en/staff/stefan-tilkov/">Stefan Tilkov</a>, <time datetime="2017-06-26">Dec 2, 2009</time></small><p>
	</header>
	<section>
	  <p>Tim Bray has put up an excellent set of <a href="http://www.tbray.org/ongoing/When/200x/2009/12/01/Clojure-Theses">theses on Clojure</a>. I can agree with most of them, but wonder about the idea that "Lisp is a handicap".</p>

<p>I understand where Tim comes from, and I fully admit that even after playing with Lisp, Scheme and Clojure for quite some time, I'm still not sure whether this is really an issue. I would only feel qualified to really comment on it once I have used it on a real project with some complexity. But what I found interesting is the example Tim gives:</p>

<pre style="color:#000000;background:#ffffff;"><span style="color:#808030; ">(</span><span style="color:#800000; font-weight:bold; ">apply</span> merge-with <span style="color:#808030; ">+</span>
<span style="color:#808030; ">(</span><span style="color:#800000; font-weight:bold; ">pmap</span> count-lines
<span style="color:#808030; ">(</span><span style="color:#800000; font-weight:bold; ">partition-all</span> *batch-size*
<span style="color:#808030; ">(</span><span style="color:#800000; font-weight:bold; ">line-seq</span> <span style="color:#808030; ">(</span><span style="color:#800000; font-weight:bold; ">reader</span> filename<span style="color:#808030; ">)</span><span style="color:#808030; ">)</span><span style="color:#808030; ">)</span><span style="color:#808030; ">)</span><span style="color:#808030; ">)</span>
</pre>

<p>I find this particular example to be extremely readable if you read it from the inside out - the <code>reader</code> function presumably returns a reader for the file named <code>filename</code>; <code>line-seq</code> returns a (lazy) sequence of the lines in the file, <code>partition-all</code> cuts this into segments (using <code>*batch-size*</code> as the, well, batch size), <code>pmap</code> maps the function <code>count-lines</code> over the result in parallel, returning a list of maps; finally, <code>merge-with +</code> combines all of the values for the same keys in the map by adding them. (Obviously the source code is much more understandable than my prose version.)</p>

<p>I agree there is a ton of Lisp code out there that's intimidating, but I don't see this as a good example. Let's invent a language with similar expressiveness, but more traditional syntax:</p>

<p /><pre style="color:#000000;background:#ffffff;"><span style="color:#800000; font-weight:bold; ">apply</span><span style="color:#808030; ">(</span>mergeWith<span style="color:#808030; ">(</span>plus<span style="color:#808030; ">)</span><span style="color:#808030; ">,</span>
<span style="color:#800000; font-weight:bold; ">pmap</span><span style="color:#808030; ">(</span>countLines<span style="color:#808030; ">,</span>
<span style="color:#800000; font-weight:bold; ">partitionAll</span><span style="color:#808030; ">(</span>BATCH_SIZE<span style="color:#808030; ">,</span>
<span style="color:#800000; font-weight:bold; ">lineSeq</span><span style="color:#808030; ">(</span><span style="color:#800000; font-weight:bold; ">reader</span><span style="color:#808030; ">(</span>filename<span style="color:#808030; ">)</span><span style="color:#808030; ">)</span><span style="color:#808030; ">)</span><span style="color:#808030; ">)</span><span style="color:#808030; ">)</span><span style="color:#808030; ">;</span>
</pre>

<p>I can't see how this would be easier to read. It's not the syntax (at least not in this case) that might be a problem if you're not used to it, it's the style of using nested function invocations – which I believe is something you get used to really quickly if using any kind of language that supports functional idioms.</p>

<section class="comments">



<div class="comment" id="comment-2083">
On <a href="#comment-2083" title="Permalink to this comment">December  2, 2009 11:04 AM</a>, <a href="http://www.symphonious.net" title="http://www.symphonious.net" rel="nofollow">symphonious.net</a>

<a href="http://www.symphonious.net" class="commenter-profile"></a>
said:
<p>I&#8217;d say the real problem with both of those versions is that they implement pretty much the entire wide-finder project in one line of code.  Breaking it up makes it much more readable (and puts it mostly back in the right order).</p>

<p>var lines = lineSeq(reader(filename));
var processedData = pmap(countLines, partitionAll(BATCH_SIZE, lines));
var result = mergeWith(plus, processedData);</p>

<p>You can vary how much or how little you break it down to get the balance right, but this is dramatically more readable than the original because you can see the three key components - get the data and split it into lines, process the data in parallel and finally put it all back together.  Extracting some methods for those three lines to give them more readable names may be well worth while too.</p>

<p>Cheers,</p>

<p>Adrian Sutton.</p>


<div class="comment" id="comment-2084">
On <a href="#comment-2084" title="Permalink to this comment">December  2, 2009 11:38 AM</a>, 
<a href="/en/staff/st/">Stefan Tilkov</a>
said:
<p>It&#8217;s a matter of taste to a certain degree, but in any case even your version would look very similar if it were written in Clojure.</p>


<div class="comment" id="comment-2085">
On <a href="#comment-2085" title="Permalink to this comment">December  2, 2009 12:20 PM</a>, <a href="http://dcsobral.blogspot.com" title="http://dcsobral.blogspot.com" rel="nofollow">Daniel Sobral</a>
said:
<p>It&#8217;s a language thing. English speakers (and those of many other languages) are used to see subject first, then verb, and Lisp inverts that. That same snippet written in Scala (minus pmap), would read like this:</p>

<p>Source fromPath &#8220;scotch.scala&#8221; getLines &#8220;\n&#8221; grouped 5 map (<em>.size) reduceLeft (</em>+_)</p>

<p>For better or worse, most people find this more natural.</p>


<div class="comment" id="comment-2086">
On <a href="#comment-2086" title="Permalink to this comment">December  2, 2009  1:05 PM</a>, <a href="http://clojure.org" title="http://clojure.org" rel="nofollow">Rich Hickey</a>
said:
<p>Yes, as you say, it can be a style or familiarity issue. As you demonstrated, you can write nested calls in any language, and people do, up to a certain degree of complexity. Then they will (and should) switch away from &#8216;inside out&#8217;. The same is true in Clojure, which supports multiple sequential styles cleanly.</p>

<p>The same code in a pipelined Clojure style:</p>

<pre>
(->> (line-seq (reader filename))
(partition-all *batch-size*)
(pmap count-lines)
(apply merge-with +))
</pre>

<p>and in a step-wise Clojure style with labeled interim results (a la Adrian&#8217;s comment):</p>

<pre>
(let [lines (line-seq (reader filename))
processed-data (pmap count-lines
(partition-all *batch-size* lines))]
(apply merge-with + processed-data))
</pre>

<p>Most Clojure programmers will be familiar with and mix these three styles, preferring, I hope, the one that makes the code clearest in a given situation.</p>

<p>Regards,</p>

<p>Rich</p>


<div class="comment" id="comment-2087">
On <a href="#comment-2087" title="Permalink to this comment">December  3, 2009 12:19 AM</a>, 
<a href="/en/staff/st/">Stefan Tilkov</a>
said:
<p>@Rich: Honored to have you pay a visit here, and thanks for the pipelining example.</p>


<div class="comment" id="comment-2089">
On <a href="#comment-2089" title="Permalink to this comment">December  5, 2009  1:07 PM</a>, <a href="http://uxul.wordpress.com/" title="http://uxul.wordpress.com/" rel="nofollow">dasuxullebt</a>
said:
<p>Yet another discussion about the readability of Lisp. When will we ever learn to ignore this type of criticism, and accept that there are people who like lisp-syntax, and people who dont?</p>


</section>

	</section>
      </article>
    </main>

  </body>
</html>


